#Update 2025-7

**تحديثات شهر سبعة **

## 2025-07-01 - 2025-07-02
**Support `user_is_morph` Config and `markable` Include Relation In API Version 2**

تحديثات متنوعة تخص كلاً من المفضلة والمحفوظات والإعجابات وتفاعلات المستخدم حيث تم إضافة العلاقة المسماة `markable` من أجل جلب بيانات الكائن المتأثر بالعملية وتم دعم خاصية `user_is_morph` في إعدادات كل نوع بحيث يمكن تفعيل هذه الخاصية لإرجاع بيانات المستخدم الذي قام بالحدث في العلاقة بشكل موحد.

**يمكن تفعيل وضع إرجاع بيانات المستخدم بشكل مختصر من خلال تفعيل المتغير التالي في النظام، علماً أن القيمة الافتراضية هي عدم تفعيل:**

```plaintext
NANO_MARKABLEAPI_FAVORITES_USER_IS_MORPH = true
NANO_MARKABLEAPI_LIKES_USER_IS_MORPH = true
NANO_MARKABLEAPI_BOOKMARKS_USER_IS_MORPH = true
NANO_MARKABLEAPI_REACTIONS_USER_IS_MORPH = true
```

الروابط المتأثرة هي كالتالي:

```plaintext
GET /api/v1/markable/favorites
GET /api/v1/markable/likes
GET /api/v1/markable/bookmarks
GET /api/v1/markable/reactions
```

---

## 2025-07-03
**Support `is_show_statues_picker` in orders**

- Support `is_show_statues_picker` in orders
- Support `getExceptOptions` in `OrderHelper`

تحديثات في جزء إدارة الطلبات حيث تم إضافة خاصية باسم `is_show_statues_picker` لتوضيح طريقة حرض حالة الطلب وذلك بغرض استخدامها في الأنواع التي من نوع حجز فندق أو تذكرة طيران وغيرها. وتم عمل إعدادات من خلالها يمكن تحديد أنواع الطلبات التي لها حالات مختلفة كالتالي:

```plaintext
NANO_ORDERS_ORDERS_STATUS_PICKER_EXCEPT_OPTIONS = 'booking_hotel,booking_halls,booking_apartment,travel_ticket,flight_ticket,other_services'
```

يمكن مشاهدة الفيديو والصور لتوضيح أهمية هذا التحديث لمطوري الفرونت اند.

---

## 2025-07-03 - 2025-07-05
**Support Get List Carts and Delete And Destroy All Carts**

تحديثات متنوعة في جزء السلة وإدارة الأصناف في السلة حيث تم عمل API لجلب بيانات عربات التسوق الخاصة بالمستخدم بحيث يمكن أن يكون للمستخدم أكثر من عربة تسوق بحسب نوع الطلب والمتجر الذي طلب منه وأيضاً تم إضافة API لتدمير وحذف كافة عربات التسوق بدلاً من تدمير كل سلة على حدة. وتم عمل التوثيق الخاص بالتحديثات.

**الـ API الجديدة هي كالتالي:**

```plaintext
GET /api/v1/shop/carts/list
DELETE /api/v1/shop/carts/destroy/all
```

---

## 2025-07-06 - 2025-07-07
**Support Author Backend Interfaces**

تم إضافة جزء التعامل مع المؤلفين ضمن النظام بحيث يمكن ربط الأصناف التي من نوع كتب بالمؤلفين بكل سهولة في النظام. بحيث يعمل هذا الجزء كوحدة برمجية مستقلة يمكن تثبيتها في متاجر الكتب أو حسب الحاجة إليها فقط. عند تثبيت هذا الجزء سيتم إضافة الحقول والفلاتر الخاصة بربط المؤلف بالكتب في واجهات إدارة الأصناف بشكل تلقائي. كما توجد العديد من الإعدادات الخاصة بالمؤلفين من حيث ربطها بحسابات المستخدمين أو الحسابات المالية وغيرها. وفي المستقبل القريب سيتم دعم واجهات تقارير الأصناف بحيث يمكن فلترة بيانات الأصناف في التقارير حسب المؤلفين. يمكن مشاهدة الصور والفيديو للتوضيح.

---

## 2025-06-08
**Support Publisher Backend Interfaces**

تم إضافة جزء التعامل مع الناشرين (دار النشر بالنسبة للأصناف التي من نوع كتاب) ضمن النظام بحيث يمكن ربط الأصناف التي من نوع كتب بدار النشر بكل سهولة في النظام. بحيث يعمل هذا الجزء كوحدة برمجية مستقلة يمكن تثبيتها في متاجر الكتب أو حسب الحاجة إليها فقط. عند تثبيت هذا الجزء سيتم إضافة الحقول والفلاتر الخاصة بربط دار النشر بالكتب في واجهات إدارة الأصناف بشكل تلقائي. كما توجد العديد من الإعدادات الخاصة بدور النشر من حيث ربطها بحسابات المستخدمين أو الحسابات المالية وغيرها. وفي المستقبل القريب سيتم دعم واجهات تقارير الأصناف بحيث يمكن فلترة بيانات الأصناف في التقارير حسب دار النشر. يمكن مشاهدة الصور والفيديو للتوضيح.

---

## 2025-07-09
**Support Event `api.list.extendQueryBefore` and `api.list.extendQuery`**

تحديثات في آلية جلب السجلات في كلاً من الفروع والأصناف والإعلانات حيث تم إضافة أحداث تمكن من حقن استعلامات جلب البيانات عن طريق وحدات برمجية أخرى وذلك لتفادي التعديل في الكود مستقبلاً. تسمح هذه الأحداث بإضافة شروط وفلاتر من خلال الاستماع للحدث وتطبيق الشروط المناسبة حسب الحاجة من خلال أي وحدة برمجية أخرى.

- Support Event `api.list.extendQueryBefore` and `api.list.extendQuery` To Department in API Version 2
- Support Event `api.list.extendQueryBefore` and `api.list.extendQuery` To Products in API Version 2
- Support Event `api.list.extendQueryBefore` and `api.list.extendQuery` To Adverts in API Version 2

```php
Event::listen('api.list.extendQuery', function ($query, $controller, $model, $params) {
    if (is_object($model) && $model->isClassExtendedWith('Nano\Subjects\Behaviors\SubjectsModel')) {
        $subjects_id = $params['subjects_id'] ?? null;
        if ($subjects_id) {
            $query->whereHasSubjects($subjects_id);
        }
    }
});

// or

Event::listen('api.list.extendQueryBefore', function ($query, $controller, $model, $input_data) {
    $newQuery = MyModel::newQuery();
    return $newQuery;
});
```

---

## 2025-07-09 - 2025-07-10
**Support Authors And Publishers API**

تم عمل الـ API الخاص بالمؤلفين والناشرين ضمن المتجر الإلكتروني وتم عمل التوثيق الخاص بهم بشكل كامل مع عدة أمثلة وتم توضيح علاقات جلب المؤلفين والناشرين ضمن بيانات الصنف (الكتاب) في الـ API الخاص بالأصناف كما يمكن فلترة الأصناف حسب المؤلفين أو الناشرين. يمكن مشاهدة الفيديو والصور للتوضيح.

---

## 2025-07-11 - 2025-07-12
**Support Classrooms Backend Interfaces And API Version 2**

تم إضافة جزء التعامل مع الصفوف الدراسية كوحدة برمجية مستقلة ضمن النظام بحيث يمكن ربط الأصناف التي من نوع كتب بالصفوف الدراسية بكل سهولة في النظام كما يمكن ربط أي كائنات أخرى كالمستخدمين مثلاً بكل سهولة من الإعدادات. بحيث يعمل هذا الجزء كوحدة برمجية مستقلة يمكن تثبيتها في متاجر الكتب أو حسب الحاجة إليها فقط. عند تثبيت هذا الجزء سيتم إضافة الحقول والفلاتر الخاصة بربط الصفوف الدراسية بواجهات الكائنات المرتبطة به بشكل تلقائي. كما توجد العديد من الإعدادات الخاصة بهذا الجزء من حيث ربطها بحسابات المستخدمين والمواد الدراسية وغيرها. وتم عمل الـ API الخاص بهذا الجزء بشكل كامل مع استكمال التوثيق الخاص به مع عدة أمثلة للتعامل مع الصفوف الدراسية وكيفية جلب الأصناف (الكتب) بناءً على الصفوف والعكس وتم عمل فلاتر لفلترة الأصناف حسب الصفوف وغيرها. يمكن مشاهدة الصور والفيديو للتوضيح.

---

## 2025-07-13 - 2025-07-14
**Support Subjects Backend Interfaces And API Version 2**

تم إضافة جزء التعامل مع المواد الدراسية كوحدة برمجية مستقلة ضمن النظام بحيث يمكن ربط الأصناف التي من نوع كتب بالمواد الدراسية بكل سهولة في النظام كما يمكن ربط أي كائنات أخرى كالمستخدمين مثلاً بكل سهولة من الإعدادات. بحيث يعمل هذا الجزء كوحدة برمجية مستقلة يمكن تثبيتها في متاجر الكتب أو حسب الحاجة إليها فقط. عند تثبيت هذا الجزء سيتم إضافة الحقول والفلاتر الخاصة بربط المواد الدراسية بواجهات الكائنات المرتبطة به بشكل تلقائي. كما توجد العديد من الإعدادات الخاصة بهذا الجزء من حيث ربطها بحسابات المستخدمين والصفوف الدراسية وغيرها. وتم عمل الـ API الخاص بهذا الجزء بشكل كامل مع استكمال التوثيق الخاص به مع عدة أمثلة للتعامل مع المواد الدراسية وكيفية جلب الأصناف (الكتب) بناءً على المواد الدراسية والعكس وتم عمل فلاتر لفلترة الأصناف حسب المواد الدراسية وغيرها. يمكن مشاهدة الصور والفيديو للتوضيح.

---

## 2025-07-15 - 2025-07-16
**Support Product Type Management**

تم إضافة آلية لإدارة أنواع المنتجات أو الأصناف حيث تم تقسيم المنتجات إلى أنواع. من خلال هذه الأنواع يمكنك إدارة الأصناف بشكل أفضل حيث لكل نوع طبيعة معينة في التعامل والإدارة برمجياً. مثلاً، المنتجات الرقمية لها تعامل يختلف عن المنتجات العامة وعن الأطعمة وأيضاً الكتب لها تعامل مختلف وتتطلب أن ترتبط بالمؤلفين والناشرين وغيرها. لذلك تم عمل هذه الآلية لإدارة المنتجات بشكل أفضل. يتم التحكم بالأنواع المدعومة في أي نسخة من خلال الإعدادات ومن خلال الواجهات التي قمنا بإضافتها في هذا التحديث.

**ملاحظة: يتم تقسيم الأصناف إلى أنواع رئيسية في النظام. هذه الأنواع هي كالتالي:**

```json
{
    "products": "منتجات عامة",
    "services": "خدمات عامة",
    "food": "أطعمة وماكولات",
    "drugs": "أدوية طبية",
    "digital": "منتجات رقمية كالبرامج والتطبيقات",
    "books": "كتب"
}
```

**يمكن التحكم بتفعيل الأنواع السابقة بشكل عام في النسخة المثبتة من النظام من خلال الإعدادات ويمكن للعميل تفعيل أو إيقاف الأنواع من خلال الواجهات.**

---

## 2025-07-16 - 2025-07-17
**Update View Reports Accounts**

تحديث طريقة عرض التقارير المحاسبية والسندات في جزء الحسابات بحيث يكون عرض التقارير والسندات مناسب مع شاشة الجوال.

---

## 2025-07-17 - 2025-07-18
**Support `order_type explore` And Update `Tags Types API`**

- Support `order_type explore`
- Support Filters `isNotHidden` and `isHidden` in `/api/v1/orders/orderstypes`
- Update `Tags Types`
- Support Filters `is_has_departments` and `is_active_departments` and `is_not_hidden_departments` in `/api/v1/tags/types` API

تحديثات متنوعة في جزء إدارة الطلبات حيث تم إضافة فلاتر لفلترة أنواع الطلبات حسب الظاهر في التطبيق أو الويب فقط بحيث يمكن تفعيل بعض الأنواع دون نشرها في التطبيق وتم إضافة نوع طلب باسم "استكشف" من أجل تطبيق المسافر ديركت. وتم تحديث جزء جلب الفئات الرئيسية `tags types` حيث تم إضافة فلات خاصة بإرجاع الفئات التي تمتلك متاجر فقط وغيرها من التحسينات الأخرى.

لتفعيل النوع الخاص بجزء "استكشف" نستخدم الإعداد التالي:

```plaintext
NANO_ORDERS_TYPES_EXPLORE = true
```

---

## 2025-07-19
**Update StepState In OrderManager**

- Update `StepState` In `OrderManager`
- Support config `is_allow_state`
- Support config `is_required_state`

تحديثات متنوعة في إدارة الطلبات حيث تم إضافة إعدادات للتحكم بضرورة تحديد المدينة أو لا وذلك لتجاوز فرض استخدام المدن في الطلبات في إعدادات المتاجر المتعددة. هذه الإعدادات هي كالتالي والقيم الافتراضية لها هي null والتي تعني استخدام إعدادات المتجر وفي حال أردنا تجاوز إعدادات المتجر يمكننا وضع قيم لهذه الإعدادات كالتالي:

```plaintext
# هل يسمح بالتعامل مع المدن في الطلبات، في حال ترك القيمة فارغة سيتم الاعتماد على إعدادات تعدد المتاجر 
NANO_ORDERS_MANAGER_IS_ALLOW_STATE = true
# للتحكم هل تحديد المدينة الزامي أم لا أم يعتمد على إعدادات تعدد المتاجر في الإضافة الأخرى 
NANO_ORDERS_MANAGER_IS_REQUIRED_STATE = false
```

---

## 2025-07-20 - 2025-07-21
**Support `sameproducts` and `samestore` relationships To Products in API Version 2**

**تم إضافة العلاقات الخاصة بجلب الأصناف المشابهة والأصناف لنفس المتجر ضمن بيانات الصنف حيث سابقاً لم تكن موجودة كعلاقات ضمن الصنف ولديها جزء منفصل بها والآن تم إضافتها كعلاقات ضمن الصنف.**
**يفضل استخدام هذه العلاقات عند جلب صنف واحد فقط ولا يفضل استخدامها عند جلب قائمة الأصناف.**

```json
{
    "sameproducts": "العلاقة الخاصة بجلب الأصناف المشابهة للصنف الحالي",
    "samestore": "العلاقة الخاصة بجلب الأصناف لنفس البائع للصنف الحالي",
    "include": "sameproducts,samestore"
}
```

**انظر المثال رقم 3.4.2 للاطلاع على بيانات العلاقات `sameproducts,samestore`.**

**يمكننا التحكم بعدد السجلات الراجعة ضمن العلاقة الخاصة بجلب الأصناف المشابهة أو الأصناف لنفس البائع كالتالي:**

```plaintext
GET http://localhost:8006/api/v1/shop/products/15?include=sameproducts,samestore,associations_products,product_options&sameproducts[per_page]=2&samestore[per_page]=2
```

---

## 2025-07-22 - 2025-07-23
**Support Behaviors DynamicAddIncludeReviews API Version 2**

- Support Behaviors DynamicAddIncludeReviews API Version 2
- Support `reviews` and `reviews_statistical` and `reviews_count` relationships To Products in API Version 2

تم إضافة آلية وكلاسات لحقن واجهات الـ API المرتبطة بالتقييمات بحيث يتم إضافة العلاقات الخاصة بالتقييمات والمراجعات إلى الكائن المرتبط بها تلقائيًا في الـ API. وذلك يمكننا من استدعاء وجلب بيانات هذه العلاقات مع الكائنات بشكل مباشر بدلاً من استخدام الـ API الرسمي لجلب مراجعات أي كائن في النظام. 

**العلاقات التي يتم حقنها هي كالتالي:**

```json
{
  "reviews": "العلاقة الخاصة بجلب التقييمات والمراجعات التابعة للصنف مع إمكانية تحديد عدد المراجعات الراجعة مع الصنف",
  "reviews_statistical": "العلاقة الخاصة بجلب إحصائيات التقييمات للصنف كعدد الأشخاص الذين قيموا الصنف بنجمة واحدة وكم قيمة بنجمتين وهكذا",
  "reviews_count": "العلاقة الخاصة بإرجاع عدد التقييمات على الصنف"
}
```

لا يفضل تضمين هذه العلاقات عند جلب قائمة الأصناف أو جلب أكثر من سجل ويفضل استخدامها في حالة جلب بيانات سجل واحد أو صنف واحد فقط.

يمكن مشاهدة الفيديو والصور لتوضيح التعامل مع هذه العلاقات.

---

## 2025-07-23
**Support `is_force_reviews_user_morph` parameters in Reviews API Version 2**

تم تحديث جزء التقييمات في الـ API بحيث أصبح بالإمكان التحكم بشكل البيانات الراجعة في علاقة المستخدم الذي قام بالتقييم وذلك من خلال البراميتر التالي:

```json
{
  "is_force_reviews_user_morph": 0
}
```

**يمكن تفعيل وضع إرجاع بيانات المستخدم بشكل مختصر من خلال تفعيل المتغير التالي في النظام علماً أن القيمة الافتراضية هي عدم تفعيل:**

```plaintext
NANO_REVIEWSAPI_REVIEWS_USER_IS_MORPH = true
```

**لفرض إرجاع بيانات المستخدم في التقييمات بشكل مختصر نقوم بتمرير البراميتر التالي:**

```json
{
  "is_force_reviews_user_morph": 1
}
```

---

## 2025-07-24
**Update Comments API Version 2**

- Support Behaviors DynamicAddIncludeComments API Version 2
- Support `is_force_comments_user_morph` parameters in Comments API Version 2

تم إضافة آلية وكلاسات لحقن واجهات الـ API المرتبطة بالتعليقات بحيث يتم إضافة العلاقات الخاصة بالتعليقات إلى الكائن المرتبط بها تلقائيًا في الـ API. وذلك يمكننا من استدعاء وجلب بيانات هذه العلاقات مع الكائنات بشكل مباشر بدلاً من استخدام الـ API الرسمي لجلب تعليقات أي كائن في النظام. 

**العلاقات التي يتم حقنها هي كالتالي:**

```json
{
  "comments": "العلاقة الخاصة بالتعليقات",
  "comments_count": "عدد التعليقات"
}
```

وبحيث أصبح بالإمكان التحكم بشكل البيانات الراجعة في علاقة المستخدم الذي قام بالتعليقات وذلك من خلال البراميتر التالي:

```json
{
  "is_force_comments_user_morph": 0
}
```

**يمكن تفعيل وضع إرجاع بيانات المستخدم بشكل مختصر من خلال تفعيل المتغير التالي في النظام علماً أن القيمة الافتراضية هي عدم تفعيل:**

```plaintext
NANO_COMMENTSAPI_COMMENTS_USER_IS_MORPH = true
```

**لفرض إرجاع بيانات المستخدم في التقييمات بشكل مختصر نقوم بتمرير البراميتر التالي:**

```json
{
  "is_force_comments_user_morph": 1
}
```

---

## 2025-07-25
**Update View Reports Orders And School And Absences**

تحديث طريقة عرض وتصفح التقارير في شاشة الجوال لكل من تقارير الطلبات والأصناف وتقارير المدرسة وتقارير الحضور والغياب والأنشطة.

---

## 2025-07-26
**Support `is_menus_array` in Get All Data API**

تحديث جزء إرجاع كافة البيانات أو بيانات الواجهة الرئيسية حيث أصبح بالإمكان إرجاع القوائم `menus` على شكل مصفوفة من الكائنات وذلك من خلال تمرير المتغير التالي بالقيمة واحد:

```plaintext
is_menus_array = 1
```

```plaintext
GET http://localhost:8006/api/v1/shop/all?is_menus_array=1
```

**كما يمكن التحكم بطريقة إرجاع قوائم الأصناف من خلال الإعدادات التالية في ملف النظام:**

```plaintext
# هل يتم إرجاع قوائم الأصناف كا مصفوفة في جلب كافة البيانات 
API_ALL_DATA_IS_MENUS_ARRAY = false
```

---

## 2025-07-27 - 2025-07-29
**Support Permission Students And Parents List API**

تم تحديث الـ API الخاص بالتعامل مع بيانات الطلاب وأولياء الأمور. حيث تم عمل إعدادات للتحكم بصلاحيات التعامل مع هذه الأجزاء حيث يمكن تحديد الجهات المخول لها بالوصول إلى هذا الجزء وهل يتم فحص صلاحياتهم أم لا. وتم استكمال التوثيق الخاص بهذا الجزء مع عمل عدة أمثلة. يمكن مشاهدة الفيديو والصور للتوضيح.

**الإعدادات الخاصة بصلاحيات الوصول إلى بيانات الطلاب هي كالتالي:**

```plaintext
# السماح بجلب السجلات
NANO_STUDENTSAPI_STUDENTS_IS_ALLOW_LIST = true
# هل يجب التحقق من وجود مستخدم ومن صلاحياتهم أم تعتبر عامة بدون التحقق
NANO_STUDENTSAPI_STUDENTS_IS_CHECK_ACCESS_LIST = true
# السماح باستخدام دالة جلب السجلات من قبل مستخدمين الباك اند  
NANO_STUDENTSAPI_STUDENTS_IS_ALLOW_LIST_BACKEND = true
# التحقق من صلاحيات مستخدمين الباك اند عند جلب السجلات 
NANO_STUDENTSAPI_STUDENTS_IS_CHECK_LIST_PERMISSION = true
# السماح باستخدام دالة جلب السجلات من قبل مستخدمين الفرونت اند 
NANO_STUDENTSAPI_STUDENTS_IS_ALLOW_LIST_FRONTEND = true
```

---

## 2025-07-29
**Support Filter `status_class` students in reports accounts balances**

تم تحديث تقرير أرصدة الحسابات وبالأخص أرصدة حسابات الطلاب حيث تم إضافة حالة الطالب في الصف إلى التقرير بحيث يمكن عمل كشوفات بأرصدة الطلاب المستمرين وأرصدة الطلاب المحولين أو الغير مؤكدين في النظام. يمكن مشاهدة الفيديو للتوضيح.

---

## 2025-07-30 - 2025-07-31
**Support Videos In Products to Backend Interfaces And API Version 2**

- Support Videos In Products API Version 2
- Support `is_mate_data_videos` and `is_mate_data_files` In Products API Version 2

تم إضافة ميزة التسوق بالفيديو إلى المتجر الإلكتروني حيث أصبح بالإمكان إضافة فيديوهات للأصناف مع إمكانية فلترة الأصناف حسب الفيديوهات وتم إضافة الـ API الخاص بذلك مع عمل التوثيق الخاص به بشكل كامل وتم إضافة ميزة إرجاع البيانات الوصفية للصور والملفات والفيديوهات حسب الحاجة كما هو موضح بالشرح في الفيديو والصور.

**لفلترة الأصناف حسب احتوائها على فيديوهات نستخدم البراميتر التالي:**

```json
{
    "is_has_videos": 1
}
```

**لإرجاع معلومات عن الصور والملفات والفيديوهات نستخدم البراميترات التالية:**

```json
{
    "is_mate_data_images": "قيمة منطقية صفر أو واحد لإرجاع 
    معلومات عن الصور كالوصف والعنوان وغيرها",
    "is_mate_data_videos": "قيمة منطقية صفر أو واحد لإرجاع 
    معلومات عن الفيديوهات كالوصف والعنوان وغيرها",
    "is_mate_data_files": "قيمة منطقية صفر أو واحد لإرجاع 
    معلومات عن الملفات كالوصف والعنوان وغيرها"
}
```

---

## 2025-07-31
**Improve the design of the user interface buttons in the control panel**

تحسين تصميم أزرار واجهات المستخدم في لوحة التحكم.
